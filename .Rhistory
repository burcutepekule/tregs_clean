# points(valleys_x, valleys_y, col="blue", pch=19, cex=1.5)
#
# sd_tol_in = 10^valleys_x[2] # take the second, less conservative?
# Your variable (epithelial score) spans 100 units: between 25 to 125
# For a distribution on that scale:
# SD ≈ 5–10 → very low variation
# SD ≈ 10–20 → moderate variation
# SD ≈ 20–30+ → high variation
#----- cases where randomizing tregs have the opposite effect to turning them on, and significant?
df_comparisons_keep  = df_comparisons
df_comparisons_sense = df_comparisons %>% dplyr::mutate(makes_sense=ifelse(sign(diff_tregs_on_minus_off)!=sign(diff_notrnd_minus_rnd)
& abs(diff_notrnd_minus_rnd)>tol_in
& (abs(d_tregs_rnd_vs_nrnd_pathogen)>=jsd_th | abs(d_tregs_rnd_vs_nrnd_sterile)>=jsd_th) ,0,1)) #either for sterile or pathogenic
df_comparisons_sense = df_comparisons_sense %>% dplyr::filter(makes_sense==0)
dim(df_comparisons_sense)[1] #0! -> ALL MAKES SENSE # IF (sign(diff_tregs_on_minus_off)!=sign(diff_notrnd_minus_rnd), it's insignificant, meaning d_tregs_rnd_vs_nrnd_pathogen<0.5 (or d_tregs_rnd_vs_nrnd_sterile<0.5)!
#----- Find significant cases
df_comparisons_plot            = df_comparisons_keep
# --- PATHOGENIC ---
df_comparisons_plot_pathogenic = df_comparisons_plot %>% dplyr::filter(injury_type=='pathogenic')
df_comparisons_plot_pathogenic = df_comparisons_plot_pathogenic %>% dplyr::mutate(tregs_better = ifelse(diff_tregs_on_minus_off > tol_in, 1,
ifelse(diff_tregs_on_minus_off < -1*tol_in,-1,0)))
df_comparisons_plot_pathogenic = df_comparisons_plot_pathogenic %>% dplyr::mutate(tregs_better_cohens = ifelse(abs(d_tregs_on_vs_off_pathogen)>jsd_th,
# & tregs_on_no_rnd_sd<sd_tol_in
# & tregs_off_sd<sd_tol_in,
tregs_better, 0))
df_comparisons_plot_pathogenic = df_comparisons_plot_pathogenic %>% dplyr::select(-d_tregs_on_vs_off_sterile)
colnames(df_comparisons_plot_pathogenic)[which(colnames(df_comparisons_plot_pathogenic)=='d_tregs_on_vs_off_pathogen')]='cohens_d'
# --- STERILE ---
df_comparisons_plot_sterile = df_comparisons_plot %>% dplyr::filter(injury_type=='sterile')
df_comparisons_plot_sterile = df_comparisons_plot_sterile %>% dplyr::mutate(tregs_better = ifelse(diff_tregs_on_minus_off > tol_in, 1,
ifelse(diff_tregs_on_minus_off < -1*tol_in,-1,0)))
df_comparisons_plot_sterile = df_comparisons_plot_sterile %>% dplyr::mutate(tregs_better_cohens = ifelse(abs(d_tregs_on_vs_off_sterile)>jsd_th,
# & tregs_on_no_rnd_sd<sd_tol_in
# & tregs_off_sd<sd_tol_in,
tregs_better, 0))
df_comparisons_plot_sterile = df_comparisons_plot_sterile %>% dplyr::select(-d_tregs_on_vs_off_pathogen)
colnames(df_comparisons_plot_sterile)[which(colnames(df_comparisons_plot_sterile)=='d_tregs_on_vs_off_sterile')]='cohens_d'
# ============CONFLICT?=========================================================
tregs_better_sterile = df_comparisons_plot_sterile %>% dplyr::filter(tregs_better_cohens==1) %>% dplyr::pull(param_set_id)
tregs_worse_sterile  = df_comparisons_plot_sterile %>% dplyr::filter(tregs_better_cohens==-1) %>% dplyr::pull(param_set_id)
tregs_better_pathogenic = df_comparisons_plot_pathogenic %>% dplyr::filter(tregs_better_cohens==1) %>% dplyr::pull(param_set_id)
tregs_worse_pathogenic  = df_comparisons_plot_pathogenic %>% dplyr::filter(tregs_better_cohens==-1) %>% dplyr::pull(param_set_id)
s_better_p_better = intersect(tregs_better_sterile, tregs_better_pathogenic)
s_better_p_worse  = intersect(tregs_better_sterile, tregs_worse_pathogenic)
s_worse_p_better  = intersect(tregs_worse_sterile, tregs_better_pathogenic)
s_worse_p_worse   = intersect(tregs_worse_sterile, tregs_worse_pathogenic)
# ==============================================================================
df_comparisons_plot = rbind(df_comparisons_plot_pathogenic, df_comparisons_plot_sterile)
saveRDS(df_comparisons_plot,'./df_comparisons_plot.rds')
cohens_th = jsd_th # example threshold for x
e_th      = tol_in # example threshold for y
source('~/Dropbox/tregs_ubelix/sub_UBX_regions.R')
ggsave(
filename = paste0("./ABM_JSD.png"),
plot = p,
width = 9,
height = 6,
dpi = 300,
bg='white'
)
# print(p)
print(length(unique(dfp$param_set_id)))
dim(df_comparisons_sense)[1] #0! -> ALL MAKES SENSE # IF (sign(diff_tregs_on_minus_off)!=sign(diff_notrnd_minus_rnd), it's insignificant, meaning d_tregs_rnd_vs_nrnd_pathogen<0.5 (or d_tregs_rnd_vs_nrnd_sterile<0.5)!
dfp_p = dfp %>% dplyr::filter(injury_type=='pathogenic') %>% dplyr::select(param_set_id, tregs_better_cohens)
dfp_s = dfp %>% dplyr::filter(injury_type=='sterile') %>% dplyr::select(param_set_id, tregs_better_cohens)
colnames(dfp_p)[2]='tregs_better_cohens_p'
colnames(dfp_s)[2]='tregs_better_cohens_s'
dfp_sp = merge(dfp_p, dfp_s, by='param_set_id')
dfp_sp = dfp_sp %>% dplyr::mutate(treg_better_cohens_both = ifelse(tregs_better_cohens_p+tregs_better_cohens_s==2, 1, 0))
100*length(which(dfp_sp$tregs_better_cohens_p==1))/dim(dfp_sp)[1] # % better for pathogenic
100*length(which(dfp_sp$tregs_better_cohens_p==-1))/dim(dfp_sp)[1] # % worse for pathogenic
100*length(which(dfp_sp$tregs_better_cohens_s==1))/dim(dfp_sp)[1] # % better for sterile
100*length(which(dfp_sp$tregs_better_cohens_s==-1))/dim(dfp_sp)[1] # % worse for sterile
100*sum(dfp_sp$treg_better_cohens_both)/dim(dfp_sp)[1] # % better for both
## check sds?
df_comparisons_plot_nz = df_comparisons_plot %>% dplyr::filter(tregs_better_cohens!=0)
# check conflict?
print(c(s_better_p_worse, s_worse_p_better))
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
rm(list=ls())
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(readr)  # For read_csv
library(stringr)
library(zoo)
library(philentropy)
# Get the directory of the current script
get_script_dir = function() {
# Try rstudioapi first (works in RStudio)
if (requireNamespace("rstudioapi", quietly = TRUE) && rstudioapi::isAvailable()) {
return(dirname(rstudioapi::getSourceEditorContext()$path))
}
# Try commandArgs (works with Rscript)
args = commandArgs(trailingOnly = FALSE)
file_arg = grep("--file=", args, value = TRUE)
if (length(file_arg) > 0) {
return(dirname(normalizePath(sub("--file=", "", file_arg))))
}
# Try sys.frame (works with source())
if (!is.null(sys.frame(1)$ofile)) {
return(dirname(sys.frame(1)$ofile))
}
# Fallback to current working directory
return(getwd())
}
setwd(get_script_dir())
source("./MISC/PLOT_FUNCTIONS_ABM.R")
source("./MISC/DATA_READ_FUNCTIONS.R")
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
# check conflict?
print(c(s_better_p_worse, s_worse_p_better))
dim(df_comparisons_sense)[1] #0! -> ALL MAKES SENSE # IF (sign(diff_tregs_on_minus_off)!=sign(diff_notrnd_minus_rnd), it's insignificant, meaning d_tregs_rnd_vs_nrnd_pathogen<0.5 (or d_tregs_rnd_vs_nrnd_sterile<0.5)!
df_comparisons_ctrl = df_comparisons %>% dplyr::filter(control==1)
df_comparisons_ctrl = df_comparisons_keep %>% dplyr::filter(control==1)
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(readr)  # For read_csv
library(stringr)
library(zoo)
library(scales)
library(ggrepel)
source("./MISC/PLOT_FUNCTIONS_ABM.R")
source("./MISC/DATA_READ_FUNCTIONS.R")
df_params       = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
df_results_keep = readRDS('./data_cpp_read_abm.rds')
length(unique(df_results_keep$param_set_id))
# --- filter for complete # of reps
reps_df       = as.data.frame(table(df_results_keep$param_set_id))
keep_param_id = reps_df %>% dplyr::filter(Freq==100) %>% dplyr::pull(Var1) # 100 = 10 reps per scenario, 10 scenarios
df_results    = df_results_keep %>% filter(param_set_id %in% keep_param_id)
unique(table(df_results$param_set_id)) #66, sanity check
length(unique(df_results$param_set_id))
#----- filter based on ss_start, it cannot be too large otherwise not much to compare!
ss_start_threshold = 4500
param_id_all_below = df_results %>%
dplyr::group_by(param_set_id) %>%
dplyr::summarise(all_below = all(ss_start < ss_start_threshold), .groups = "drop") %>%
dplyr::filter(all_below) %>%
dplyr::pull(param_set_id)
length(param_id_all_below)/length(unique(df_results$param_set_id)) # >99%!
df_results = df_results %>% dplyr::filter(param_set_id %in% param_id_all_below)
max(df_results$ss_start)<ss_start_threshold # TRUE, sanity check
unique(table(df_results$param_set_id)) #600, sanity check
length(unique(df_results$param_set_id))
df_comparisons = distinct(df_results %>% dplyr::select(
param_set_id, injury_type, control, macspec_on,
# Mean scores
mean_ctrl_sterile, mean_ctrl_pathogen,
mean_tregs_off_sterile, mean_tregs_off_pathogen,
mean_tregs_on_sterile, mean_tregs_on_pathogen,
mean_tregs_rnd_sterile, mean_tregs_rnd_pathogen,
mean_macspec_sterile, mean_macspec_pathogen,
# SD scores
sd_ctrl_sterile, sd_ctrl_pathogen,
sd_tregs_off_sterile, sd_tregs_off_pathogen,
sd_tregs_on_sterile, sd_tregs_on_pathogen,
sd_tregs_rnd_sterile, sd_tregs_rnd_pathogen,
sd_macspec_sterile, sd_macspec_pathogen
))
df_comparisons_keep = df_comparisons
df_comparisons_ctrl = df_comparisons_keep %>% dplyr::filter(control==1)
View(df_comparisons_ctrl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(readr)  # For read_csv
library(stringr)
library(zoo)
library(scales)
library(ggrepel)
source("./MISC/PLOT_FUNCTIONS_ABM.R")
source("./MISC/DATA_READ_FUNCTIONS.R")
df_params       = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
df_results_keep = readRDS('./data_cpp_read_abm.rds')
length(unique(df_results_keep$param_set_id))
# --- filter for complete # of reps
reps_df       = as.data.frame(table(df_results_keep$param_set_id))
keep_param_id = reps_df %>% dplyr::filter(Freq==100) %>% dplyr::pull(Var1) # 100 = 10 reps per scenario, 10 scenarios
df_results    = df_results_keep %>% filter(param_set_id %in% keep_param_id)
unique(table(df_results$param_set_id)) #66, sanity check
length(unique(df_results$param_set_id))
#----- filter based on ss_start, it cannot be too large otherwise not much to compare!
ss_start_threshold = 4500
param_id_all_below = df_results %>%
dplyr::group_by(param_set_id) %>%
dplyr::summarise(all_below = all(ss_start < ss_start_threshold), .groups = "drop") %>%
dplyr::filter(all_below) %>%
dplyr::pull(param_set_id)
length(param_id_all_below)/length(unique(df_results$param_set_id)) # >99%!
df_results = df_results %>% dplyr::filter(param_set_id %in% param_id_all_below)
max(df_results$ss_start)<ss_start_threshold # TRUE, sanity check
unique(table(df_results$param_set_id)) #600, sanity check
length(unique(df_results$param_set_id))
df_comparisons = distinct(df_results %>% dplyr::select(
param_set_id, injury_type, control, macspec_on,
# Mean scores
mean_ctrl_sterile, mean_ctrl_pathogen,
mean_tregs_off_sterile, mean_tregs_off_pathogen,
mean_tregs_on_sterile, mean_tregs_on_pathogen,
mean_tregs_rnd_sterile, mean_tregs_rnd_pathogen,
mean_macspec_sterile, mean_macspec_pathogen,
# SD scores
sd_ctrl_sterile, sd_ctrl_pathogen,
sd_tregs_off_sterile, sd_tregs_off_pathogen,
sd_tregs_on_sterile, sd_tregs_on_pathogen,
sd_tregs_rnd_sterile, sd_tregs_rnd_pathogen,
sd_macspec_sterile, sd_macspec_pathogen
))
df_comparisons_keep = df_comparisons
df_comparisons_sterile_ctrl = df_comparisons_keep %>% dplyr::filter(control==1 & macspec_on==0 & injury_type=='sterile')
df_comparisons_sterile_test = df_comparisons_keep %>% dplyr::filter(control==0 & macspec_on==0 & injury_type=='sterile')
View(df_comparisons_sterile_ctrl)
df_comparisons_sterile_test = df_comparisons_keep %>% dplyr::filter(control==0 & macspec_on==0 & injury_type=='sterile')
View(df_comparisons_sterile_test)
df_comparisons_ctrl = df_comparisons_keep %>% dplyr::filter(control==1 & macspec_on==0)
df_comparisons_ctrl = df_comparisons_keep %>% dplyr::filter(control==1 & macspec_on==0)
df_comparisons_test = df_comparisons_keep %>% dplyr::filter(control==0 & macspec_on==0)
View(df_comparisons_test)
View(df_comparisons)
View(df_comparisons)
df_comparisons_ctrl_test = df_comparisons_keep %>% dplyr::filter(macspec_on==0) %>% dplyr::mutate(diff_tregs_on_minus_off = ifelse(injury_type=='pathogenic',
mean_ctrl_pathogen-mean_tregs_off_pathogen,
mean_ctrl_sterile-mean_tregs_off_sterile))
View(df_comparisons_ctrl_test)
df_comparisons_ctrl_test = df_comparisons_keep %>% dplyr::filter(macspec_on==0) %>% dplyr::mutate(diff_ctrl_test = ifelse(injury_type=='pathogenic',
mean_ctrl_pathogen-mean_tregs_off_pathogen,
mean_ctrl_sterile-mean_tregs_off_sterile))
View(df_comparisons_ctrl_test)
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
rm(list=ls())
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('~/Dropbox/tregs_ubelix/UBX_datazanalyse_abm_regions.R')
rm(list=ls())
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./UBX_datazanalyse_abm_regions.R')
rm(list=ls())
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
df_params           = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
df_results_keep     = readRDS('./data_cpp_read_abm.rds')
df_plot             = readRDS('./df_comparisons_plot.rds')
df_plot             = merge(df_plot, df_params, by='param_set_id')
if(M1_M2_diff==1){
df_plot = df_plot %>% dplyr::mutate(activity_engulf_M1_M2_diff = activity_engulf_M1_baseline-activity_engulf_M2_baseline)
}
source('./MISC/LOAD_PARAM_VECTOR.R') #M1_M2_diff adjusts params as well
inj_type= 'sterile'
inj_type= 'pathogenic'
inj_type= 'pooled'
if(inj_type!='pooled'){
df_plot = df_plot %>% dplyr::filter(injury_type==inj_type)
}
df_lda  = df_plot %>% dplyr::select(all_of(param_names), tregs_better_cohens)
classes = unique(df_lda$tregs_better_cohens)
# Choose confidence levels for visualization
level_plus1  = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
level_minus1 = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
if(identical(classes, c(0,1))){
source('./MISC/PLS_DA_2classes.R')
}else{
source('./MISC/PLS_DA_3classes.R')
}
rm(list=ls())
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
df_params           = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
df_results_keep     = readRDS('./data_cpp_read_abm.rds')
df_plot             = readRDS('./df_comparisons_plot.rds')
df_plot             = merge(df_plot, df_params, by='param_set_id')
if(M1_M2_diff==1){
df_plot = df_plot %>% dplyr::mutate(activity_engulf_M1_M2_diff = activity_engulf_M1_baseline-activity_engulf_M2_baseline)
}
source('./MISC/LOAD_PARAM_VECTOR.R') #M1_M2_diff adjusts params as well
inj_type= 'sterile'
inj_type= 'pathogenic'
inj_type= 'pooled'
if(inj_type!='pooled'){
df_plot = df_plot %>% dplyr::filter(injury_type==inj_type)
}
df_lda  = df_plot %>% dplyr::select(all_of(param_names), tregs_better_cohens)
classes = unique(df_lda$tregs_better_cohens)
# Choose confidence levels for visualization
level_plus1  = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
level_minus1 = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
violin_on    = 1
if(identical(classes, c(0,1))){
source('./MISC/PLS_DA_2classes.R')
}else{
source('./MISC/PLS_DA_3classes.R')
}
# ## =====================================
#
# df_params = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
#
# neg_ids = df_plot %>% dplyr::filter(tregs_better_cohens==-1) %>% pull(param_set_id)
# pos_ids = df_plot %>% dplyr::filter(tregs_better_cohens==+1) %>% pull(param_set_id)
# net_ids = df_plot %>% dplyr::filter(tregs_better_cohens==0) %>% pull(param_set_id)
#
# df_params_pick = df_params %>% dplyr::filter(param_set_id %in% neg_ids)
#
# summary(df_params_pick$epith_recovery_chance)
rm(list=ls())
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
df_params           = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
df_results_keep     = readRDS('./data_cpp_read_abm.rds')
df_plot             = readRDS('./df_comparisons_plot.rds')
df_plot             = merge(df_plot, df_params, by='param_set_id')
if(M1_M2_diff==1){
df_plot = df_plot %>% dplyr::mutate(activity_engulf_M1_M2_diff = activity_engulf_M1_baseline-activity_engulf_M2_baseline)
}
source('./MISC/LOAD_PARAM_VECTOR.R') #M1_M2_diff adjusts params as well
inj_type= 'sterile'
inj_type= 'pathogenic'
inj_type= 'pooled'
if(inj_type!='pooled'){
df_plot = df_plot %>% dplyr::filter(injury_type==inj_type)
}
df_lda  = df_plot %>% dplyr::select(all_of(param_names), tregs_better_cohens)
classes = unique(df_lda$tregs_better_cohens)
# Choose confidence levels for visualization
level_plus1  = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
level_minus1 = 0.75 # pick from c(0.50, 0.75, 0.90, 0.95, 0.99)
violin_on    = 1
if(identical(classes, c(0,1))){
source('./MISC/PLS_DA_2classes.R')
}else{
source('./MISC/PLS_DA_3classes.R')
}
# ## =====================================
#
# df_params = read_csv('./lhs_parameters_della.csv', show_col_types = FALSE)
#
# neg_ids = df_plot %>% dplyr::filter(tregs_better_cohens==-1) %>% pull(param_set_id)
# pos_ids = df_plot %>% dplyr::filter(tregs_better_cohens==+1) %>% pull(param_set_id)
# net_ids = df_plot %>% dplyr::filter(tregs_better_cohens==0) %>% pull(param_set_id)
#
# df_params_pick = df_params %>% dplyr::filter(param_set_id %in% neg_ids)
#
# summary(df_params_pick$epith_recovery_chance)
View(df_lda)
### REORDER BASED ON WHICH PARAMETER PROFILE YOU WANT (BASED ON COHENS D OR LDA REGION)
### BECAUSE THE LAST SCRIPT WILL DEFINE WHAT "REGION" IS
source("./MISC/PARAM_HISTS_3classes.R")
if(file.exists('./ids_read_abm_abm.rds')){
inds_read = readRDS('./ids_read_abm_abm.rds')
}else{
inds_read = c()
}
inds_read
if(file.exists('./ids_read_abm.rds')){
inds_read = readRDS('./ids_read_abm.rds')
}else{
inds_read = c()
}
inds2read = sort(setdiff(indices,inds_read))
rm(list=ls())
library(dplyr)
library(tidyr)
library(ggplot2)
library(purrr)
library(readr)  # For read_csv
library(stringr)
library(zoo)
library(philentropy)
# Get the directory of the current script
get_script_dir = function() {
# Try rstudioapi first (works in RStudio)
if (requireNamespace("rstudioapi", quietly = TRUE) && rstudioapi::isAvailable()) {
return(dirname(rstudioapi::getSourceEditorContext()$path))
}
# Try commandArgs (works with Rscript)
args = commandArgs(trailingOnly = FALSE)
file_arg = grep("--file=", args, value = TRUE)
if (length(file_arg) > 0) {
return(dirname(normalizePath(sub("--file=", "", file_arg))))
}
# Try sys.frame (works with source())
if (!is.null(sys.frame(1)$ofile)) {
return(dirname(sys.frame(1)$ofile))
}
# Fallback to current working directory
return(getwd())
}
setwd(get_script_dir())
source("./MISC/PLOT_FUNCTIONS_ABM.R")
source("./MISC/DATA_READ_FUNCTIONS.R")
# Load files
results_merged             = c()
sterile_comparison_keep    = c()
pathogenic_comparison_keep = c()
path = "/Users/burcutepekule/Desktop/sim_abm/"
# Control
files_1_0_0_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_1_sterile_0_macspec_0_tregs_0_trnd_0.rds$", full.names = TRUE)
files_1_1_0_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_1_sterile_1_macspec_0_tregs_0_trnd_0.rds$", full.names = TRUE)
# === STERILE
# Test (with ROS)
files_0_0_0_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_0_macspec_0_tregs_0_trnd_0.rds$", full.names = TRUE)
files_0_0_0_1_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_0_macspec_0_tregs_1_trnd_0.rds$", full.names = TRUE)
files_0_0_0_1_1 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_0_macspec_0_tregs_1_trnd_1.rds$", full.names = TRUE)
# Test (with ROS), perfect macrophage
files_0_0_1_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_0_macspec_1_tregs_0_trnd_0.rds$", full.names = TRUE)
# === PATHOGENIC
# Test (with ROS)
files_0_1_0_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_1_macspec_0_tregs_0_trnd_0.rds$", full.names = TRUE)
files_0_1_0_1_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_1_macspec_0_tregs_1_trnd_0.rds$", full.names = TRUE)
files_0_1_0_1_1 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_1_macspec_0_tregs_1_trnd_1.rds$", full.names = TRUE)
# Test (with ROS), perfect macrophage
files_0_1_1_0_0 = list.files(path, pattern = "^longitudinal_df_param_set_id_\\d+\\_control_0_sterile_1_macspec_1_tregs_0_trnd_0.rds$", full.names = TRUE)
indices_1_0_0_0_0 = str_extract(basename(files_1_0_0_0_0), "\\d+") |> as.numeric()
indices_1_1_0_0_0 = str_extract(basename(files_1_1_0_0_0), "\\d+") |> as.numeric()
indices_0_0_0_0_0 = str_extract(basename(files_0_0_0_0_0), "\\d+") |> as.numeric()
indices_0_0_0_1_0 = str_extract(basename(files_0_0_0_1_0), "\\d+") |> as.numeric()
indices_0_0_0_1_1 = str_extract(basename(files_0_0_0_1_1), "\\d+") |> as.numeric()
indices_0_0_1_0_0 = str_extract(basename(files_0_0_1_0_0), "\\d+") |> as.numeric()
indices_0_1_0_0_0 = str_extract(basename(files_0_1_0_0_0), "\\d+") |> as.numeric()
indices_0_1_0_1_0 = str_extract(basename(files_0_1_0_1_0), "\\d+") |> as.numeric()
indices_0_1_0_1_1 = str_extract(basename(files_0_1_0_1_1), "\\d+") |> as.numeric()
indices_0_1_1_0_0 = str_extract(basename(files_0_1_1_0_0), "\\d+") |> as.numeric()
indices = Reduce(intersect, list(
indices_1_0_0_0_0, indices_1_1_0_0_0,
indices_0_0_0_0_0, indices_0_0_0_1_0,
indices_0_0_0_1_1, indices_0_0_1_0_0,
indices_0_1_0_0_0, indices_0_1_0_1_0,
indices_0_1_0_1_1, indices_0_1_1_0_0
))
# Initialize an empty results dataframe before the loop
all_comparison_results = data.frame()
if(file.exists('./ids_read_abm.rds')){
inds_read = readRDS('./ids_read_abm.rds')
}else{
inds_read = c()
}
inds2read = sort(setdiff(indices,inds_read))
length(inds2read)
message("Reprinting space.")
sd_tol_in   = Inf
jsd_th      = 0.3
tol_in      = 125*0.2
M1_M2_diff  = 1
source('./DLL_datazanalyse_abm_regions.R')
dim(df_comparisons_sense)[1] #0! -> ALL MAKES SENSE # IF (sign(diff_tregs_on_minus_off)!=sign(diff_notrnd_minus_rnd), it's insignificant, meaning d_tregs_rnd_vs_nrnd_pathogen<0.5 (or d_tregs_rnd_vs_nrnd_sterile<0.5)!
# check conflict?
print(c(s_better_p_worse, s_worse_p_better))
100*length(which(dfp_sp$tregs_better_cohens_p==1))/dim(dfp_sp)[1] # % better for pathogenic
100*length(which(dfp_sp$tregs_better_cohens_p==-1))/dim(dfp_sp)[1] # % worse for pathogenic
100*length(which(dfp_sp$tregs_better_cohens_s==1))/dim(dfp_sp)[1] # % better for sterile
100*length(which(dfp_sp$tregs_better_cohens_s==-1))/dim(dfp_sp)[1] # % worse for sterile
100*sum(dfp_sp$treg_better_cohens_both)/dim(dfp_sp)[1] # % better for both
df_comparisons_plot_nz = df_comparisons_plot %>% dplyr::filter(tregs_better_cohens!=0)
# check conflict?
print(c(s_better_p_worse, s_worse_p_better))
tregs_better_sterile = df_comparisons_plot_sterile %>% dplyr::filter(tregs_better_cohens==1 & abs(d_tregs_on_vs_off_sterile)>jsd_th) %>% dplyr::pull(param_set_id)
source('./DLL_datazanalyse_abm_all.R')
